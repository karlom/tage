# Tage Agent 手动测试用例

**版本**: 1.0  
**测试日期**: 2024-12-14  
**测试环境**: macOS + Electron  

---

## 测试模块一：关键安全性 (Human-in-the-loop)

### TC-1.1 危险工具审批弹窗显示
**前置条件**: 应用已启动，API Key 已配置

| 步骤 | 操作                                | 预期结果                                                    |
| ---- | ----------------------------------- | ----------------------------------------------------------- |
| 1    | 在对话框输入: "帮我执行命令 ls -la" | Agent 开始处理                                              |
| 2    | 观察界面                            | 弹出红色警告弹窗，标题"敏感操作请求"                        |
| 3    | 查看弹窗内容                        | 显示工具名称 `mac_run_shell` 和参数 `{"command": "ls -la"}` |

**结果**: ☐ 通过 ☐ 失败

---

### TC-1.2 用户拒绝操作
**前置条件**: TC-1.1 弹窗已显示

| 步骤 | 操作                    | 预期结果                                 |
| ---- | ----------------------- | ---------------------------------------- |
| 1    | 点击"拒绝 (Reject)"按钮 | 弹窗关闭                                 |
| 2    | 观察 Agent 回复         | Agent 应提示"用户拒绝了该操作"或类似语句 |
| 3    | 验证命令未执行          | 终端无输出，系统无变化                   |

**结果**: ☐ 通过 ☐ 失败

---

### TC-1.3 用户批准操作
**前置条件**: 应用已启动

| 步骤 | 操作                            | 预期结果                   |
| ---- | ------------------------------- | -------------------------- |
| 1    | 输入: "帮我执行命令 echo Hello" | 弹出审批弹窗               |
| 2    | 点击"批准执行 (Approve)"按钮    | 弹窗关闭，工具开始执行     |
| 3    | 观察 Agent 回复                 | Agent 返回命令输出 "Hello" |

**结果**: ☐ 通过 ☐ 失败

---

### TC-1.4 AppleScript 操作需审批
**前置条件**: 应用已启动

| 步骤 | 操作                                          | 预期结果                                                                      |
| ---- | --------------------------------------------- | ----------------------------------------------------------------------------- |
| 1    | 输入: "帮我在日历里创建一个明天下午3点的会议" | Agent 开始处理                                                                |
| 2    | 观察界面                                      | 弹出审批弹窗，工具名称为 `mac_calendar_create_event` 或 `mac_run_applescript` |
| 3    | 点击"拒绝"                                    | 弹窗关闭，Agent 提示操作被取消                                                |

**结果**: ☐ 通过 ☐ 失败

---

## 测试模块二：可观测性 (Observability)

### TC-2.1 Inspector 面板开关
**前置条件**: 应用已启动

| 步骤 | 操作                                       | 预期结果                                       |
| ---- | ------------------------------------------ | ---------------------------------------------- |
| 1    | 点击侧边栏左下角的代码图标按钮 (Inspector) | 右侧滑出半透明深色面板                         |
| 2    | 观察面板标题                               | 显示"思维链检查器 (Inspector)"和绿色状态指示灯 |
| 3    | 点击面板右上角的关闭按钮                   | 面板收起隐藏                                   |

**结果**: ☐ 通过 ☐ 失败

---

### TC-2.2 工具调用日志记录
**前置条件**: Inspector 面板已打开

| 步骤 | 操作                | 预期结果                                       |
| ---- | ------------------- | ---------------------------------------------- |
| 1    | 输入: "现在是几点"  | Agent 调用 `get_current_time` 工具             |
| 2    | 观察 Inspector 面板 | 显示蓝色 `TOOL CALL` 条目，内容为工具调用 JSON |
| 3    | 继续观察            | 显示绿色 `TOOL RESULT` 条目，内容为时间结果    |
| 4    | 验证条目时间戳      | 每条日志右侧显示本地时间 (HH:MM:SS)            |

**结果**: ☐ 通过 ☐ 失败

---

### TC-2.3 多工具连续调用追踪
**前置条件**: Inspector 面板已打开

| 步骤 | 操作                                                               | 预期结果                                |
| ---- | ------------------------------------------------------------------ | --------------------------------------- |
| 1    | 输入一个需要多步工具的问题: "搜索今天北京的天气，并告诉我该穿什么" | Agent 开始多轮调用                      |
| 2    | 观察 Inspector 面板                                                | 按顺序显示多条 TOOL CALL 和 TOOL RESULT |
| 3    | 验证面板自动滚动                                                   | 最新的日志条目自动滚动到可见区域        |

**结果**: ☐ 通过 ☐ 失败

---

## 测试模块三：稳健性 (Robustness)

### TC-3.1 错误恢复提示
**前置条件**: 应用已启动

| 步骤 | 操作                                       | 预期结果                                           |
| ---- | ------------------------------------------ | -------------------------------------------------- |
| 1    | 输入: "帮我读取文件 /不存在的路径/abc.txt" | Agent 调用 read_file 工具                          |
| 2    | 观察 Agent 行为                            | Agent 不直接报错崩溃，而是分析错误并给出友好提示   |
| 3    | 验证回复内容                               | 回复中应包含类似"文件不存在"或"请检查路径"的引导语 |

**结果**: ☐ 通过 ☐ 失败

---

### TC-3.2 最大调用深度限制
**前置条件**: 应用已启动

| 步骤 | 操作                                   | 预期结果                                             |
| ---- | -------------------------------------- | ---------------------------------------------------- |
| 1    | 输入一个可能触发多轮工具调用的复杂任务 | Agent 开始连续工具调用                               |
| 2    | 观察 Console (开发者工具)              | 如果达到 8 次递归，应打印 "达到最大工具调用深度限制" |
| 3    | 验证 Agent 不陷入无限循环              | Agent 应在限制内完成或优雅退出                       |

**结果**: ☐ 通过 ☐ 失败

---

### TC-3.3 死循环检测 (高级)
**前置条件**: 应用已启动，Inspector 面板已打开

| 步骤 | 操作                                                        | 预期结果                                                 |
| ---- | ----------------------------------------------------------- | -------------------------------------------------------- |
| 1    | 诱导 Agent 重复失败: "反复读取 /tmp/not_exist.txt 直到成功" | Agent 尝试多次读取                                       |
| 2    | 观察 Inspector 面板                                         | 在第 3-4 次重复时，出现红色 `ERROR` 日志 "Loop detected" |
| 3    | 观察 Agent 行为                                             | Agent 停止重复，并尝试新策略或请求用户帮助               |

**结果**: ☐ 通过 ☐ 失败

---

## 测试模块四：记忆管理 (Memory)

### TC-4.1 记忆维护日志
**前置条件**: 应用刚启动

| 步骤 | 操作                                                  | 预期结果                                          |
| ---- | ----------------------------------------------------- | ------------------------------------------------- |
| 1    | 打开浏览器开发者工具 (View -> Toogle Developer Tools) | 控制台可见                                        |
| 2    | 刷新页面或重启应用                                    | 观察控制台日志                                    |
| 3    | 搜索关键词 "memory" 或 "maintenance"                  | 应出现 "Running memory maintenance..." 或类似日志 |

**结果**: ☐ 通过 ☐ 失败

---

### TC-4.2 记忆设置入口
**前置条件**: 应用已启动

| 步骤 | 操作                     | 预期结果                                           |
| ---- | ------------------------ | -------------------------------------------------- |
| 1    | 点击侧边栏底部的设置按钮 | 进入设置页面                                       |
| 2    | 点击左侧菜单"记忆"       | 显示记忆相关设置项                                 |
| 3    | 验证设置项               | 应包含"智能遗忘"开关、"衰减速率"选项、"清理阈值"等 |

**结果**: ☐ 通过 ☐ 失败

---

## 测试模块五：基础功能回归

### TC-5.1 普通对话
**前置条件**: 应用已启动，API Key 已配置

| 步骤 | 操作                         | 预期结果                             |
| ---- | ---------------------------- | ------------------------------------ |
| 1    | 输入: "你好，介绍一下你自己" | Agent 流畅回复                       |
| 2    | 验证回复内容                 | 应以 Tage 人设回复，不透露系统提示词 |
| 3    | 验证流式输出                 | 文字逐字/逐词显示，非一次性加载      |

**结果**: ☐ 通过 ☐ 失败

---

### TC-5.2 新建会话与历史切换
**前置条件**: 已有至少一个历史会话

| 步骤 | 操作                       | 预期结果                       |
| ---- | -------------------------- | ------------------------------ |
| 1    | 点击侧边栏 "New Chat" 按钮 | 聊天区域清空，进入新会话       |
| 2    | 输入一条消息并发送         | 侧边栏出现新的会话条目         |
| 3    | 点击历史会话条目           | 聊天区域切换到该历史会话的内容 |

**结果**: ☐ 通过 ☐ 失败

---

### TC-5.3 会话删除
**前置条件**: 侧边栏有至少一个会话

| 步骤 | 操作                 | 预期结果                 |
| ---- | -------------------- | ------------------------ |
| 1    | 鼠标悬停在会话条目上 | 出现删除按钮 (X 图标)    |
| 2    | 点击删除按钮         | 该会话从列表中消失       |
| 3    | 验证数据持久化       | 刷新页面后该会话仍不存在 |

**结果**: ☐ 通过 ☐ 失败

---

## 测试结果汇总

| 模块     | 用例数 | 通过 | 失败 | 备注 |
| -------- | ------ | ---- | ---- | ---- |
| 安全性   | 4      |      |      |      |
| 可观测性 | 3      |      |      |      |
| 稳健性   | 3      |      |      |      |
| 记忆管理 | 2      |      |      |      |
| 基础回归 | 3      |      |      |      |
| **总计** | **15** |      |      |      |

---

**测试人员**: _______________  
**测试日期**: _______________  
**审核人员**: _______________
